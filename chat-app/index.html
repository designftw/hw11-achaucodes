<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="module" src="./chat.js"></script>
    <link rel="stylesheet" href="style.css">
    <title>Chat App</title>
</head>
<body>
  <div class="main-content">
    <div id="app">
      <h1>
        My Cool Chat App
      </h1>
      <input @change="onImageAttachment" type="file" accept="image/png, image/jpeg"/>
      <p>
        <button @click="$gf.toggleLogIn">
          <!-- If we have a user ID, we're logged in so show "Log Out" -->
          <!-- Otherwise, show "Log In" -->
          {{ $gf.me? 'Log Out' : 'Log In' }}
        </button>
      </p>
  
      <!-- If we're not logged in, hide everything except the login button -->
      <template v-if="$gf.me">
  
        <p>
          <!-- We display names in multiple places, so we made a -->
          <!-- reusable <name></name> component. -->
          <!-- See below for the template. -->
          My name is: <name :actor="$gf.me" :editable="true"></name>
        </p>

        <form>
          <label for="username">Username: </label>
          <input id="username" v-model="usernameRequest"/> 
          <button type="button" @click="requestUsername(usernameRequest)">Request</button>
          <img class="loaded" id="loader" src="images/loader.svg">      
          <span> {{this.usernameRequestError}}</span>
        </form>    
  
        <p>
          <input type="radio" id="channel" :value="false" v-model="privateMessaging" />
          <label for="channel">Channel-based public chat</label>
  
          <input type="radio" id="pm" :value="true" v-model="privateMessaging" />
          <label for="pm">Private Messaging</label>
        </p>
  
        <div v-if="!privateMessaging">
          <label for="channel">
            Channel:
          </label>
          <input id="channel" v-model="channel"/>
        </div>

        <div v-else>
          <div>
            <label for="recipient-username">
              To Username: 
            </label>
            <input id="recipient-username" v-model="recipientUsernameRequest">
            <button @click="usernameToActor(recipientUsernameRequest)">Search</button>
            <span>{{this.recipientUsernameError}}</span>
            <img class="loaded" id="loader2" src="images/loader.svg">
          </div>

          <div>
            <label for="recipient">
              To Actor ID:
            </label>
            <input id="recipient" v-model="recipient"/>
            <button @click="actorToUsername(recipient)">Search</button>
            <span>{{this.recipientUsernameError}}</span>
            <img class="loaded" id="loader3" src="images/loader.svg">
          </div>
        </div>
  
        <!-- A form for sending messages -->
        <form @submit.prevent="sendMessage">
          <div class="message-input-div">
            <textarea class="message-input" v-model="messageText" placeholder="My message is..."></textarea>
            <div class="send"><input type="submit" value="Send"/></div>
          </div>
        </form>
  
        <ul>
          <!-- List all the messages -->
          <li v-for="message of messages" :key="message.id">
  
            <!-- Display and edit form if we're editing a message -->
            <form v-if="editID==message.id" @submit.prevent="saveEditMessage(message)">
              <input v-model="editText">
              <input type="submit" value="Save"/>
            </form>
  
            <!-- Otherwise, display a bunch of properties from the message -->
            <ul v-else>
              <div v-if="message.attachment">
                {{ message.attachment }}
                <p>this is an image?</p>
              </div>
              <div class="message-bubble">
                <name :actor="message.actor"></name>
                <button @click="copy(message.actor)" class="id">Copy ID</button>

                <template v-if="privateMessaging">
                  <span id="to">To: <name :actor="message.bto[0]"></name></span>
                  <button @click="copy(message.bto[0])" class="id">Copy ID</button>
                </template>

                <span class="dateTime">{{ Date(message.published).toString().slice(0,-36) }}</span>
                <fieldset class="message">
                  <p id="message-text">{{message.content}}</p>
                  <button @click="copy(message.id)" class="id">Copy ID</button>
                  <span class="dateTime">Last Updated: {{ Date(message.updated).toString().slice(0,-36) }}</span>
                </fieldset>
  
                <!-- Only add these controls if the message is ours -->
                <!-- You can't edit or delete other people's messages -->
                <template v-if="message.actor==$gf.me">
                  <button class="edit" @click="startEditMessage(message)">
                    ‚úèÔ∏è Edit
                  </button>

                  <button class="delete" @click="removeMessage(message)">
                    üóëÔ∏è Delete
                  </button>
                </template>
              </div>
            </ul>
          </li>
        </ul>
      </template>
    </div>
  
    <template id="name">
      <span v-if="!editing">
  
        <!-- If we're not editing the name-->
        <!-- Display the profile's name, if it exists -->
        <!-- or anonymous if it doesn't -->
        {{ profile? profile.name : 'Anonymous' }}
  
        <!-- Also if the name is "editable" add an edit button -->
        <button v-if="editable" @click="editName">
          ‚úèÔ∏è Edit
        </button>
      </span>
  
      <!-- If we're in the editing state, create something to edit the name-->
      <form v-else @submit.prevent="saveName">
        <input v-model="editText"/>
        <input type="submit" value="Save Name"/>
      </form>
    </template>
  </div>
</body>
</html>
